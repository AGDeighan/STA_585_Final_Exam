---
title: "STA 585 Final Exam"
author: "Andrew Deighan"
date: "May 5, 2017"
output: html_document
---

# Responses

  The full R code for each response is given in the [appendix](#appendix).


<br>

## Question 1

  See appendix [A1](#a1) for R code.

> Use the “sleep.txt” data to answer the following questions.
A description of this data is given bellow.
>
> Species: species of animal
>
> BodyWgt: body weight in kg
>
> BrainWgt: brain weight in g
>
> Sleep: total sleep (hrs/day) (sum of slow wave and paradoxical sleep): slow wave is "nondreaming") sleep and paradoxical is "dreaming" sleep
>
> LifeSpan: maximum life span (years)
>
> The Species column should be used as row names.  
>
>
> a. Construct histograms of each variable.
> b. The strong asymmetry for all variables except Sleep indicates that a log transformation is
appropriate for those variables. Construct a new data frame that contains Sleep, replaces
BodyWgt, BrainWgt, LifeSpan by their log-transformed values, and then construct
histograms of each variable in this new data frame with all of them on the same graphics
page.
> c. Plot LifeSpan versus BrainWgt with LifeSpan on the y-axis and include an informative
title. Repeat using the log-transformed variables instead. Superimpose lines corresponding to
the respective means of the variables for each plot.
> d. Obtain and interpret the correlation between LifeSpan and BrainWgt. Repeat for
log(LifeSpan) and log(BrainWgt).
> e. Obtain the fitted regression line to predict LifeSpan based on BrainWgt. Check assumptions
with appropriate residual plots. Repeat to predict log(LifeSpan) based on log(BrainWgt).
Predict LifeSpan of Homo sapiens based on each of these regression lines. Which would you
expect to have the best overall accuracy? Which prediction is closest to the actual LifeSpan
of Homo sapiens?

```{r, include=F}
## Import data

qdata <- data.frame(read.table("data/sleep.txt", header = T, sep = ""))

rownames(qdata) <- qdata$Species

qdata <- qdata[,2:5]

```

<br>

### Part A

  The figure below shows the histograms for each variable in our raw data-set.

```{r, include=FALSE}

## Part A
png("images/q1_histograms_a.png",
    height = 620, width = 600)

par(mfrow = c(2,2), oma = c(0,0,4,0))

hist(qdata$BodyWgt, 
     main = "Distribution of Body Weight",
     xlab = "Body Weight (kg)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$BrainWgt,
     main = "Distribution of Brain Weight",
     xlab = "Brain Weight (g)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$Sleep,
     main = "Distibution of Amount of Sleep",
     xlab = "Sleep (hours/day)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$LifeSpan,
     main = "Distribution of Lifespan",
     xlab = "Lifespan (years)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of the Observed Distributions of: \n Body Weight, Brain Weight, Sleep, and Lifespan for different Species",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

```


![**Figure Q1A:** The plots in the figure above show the observed distributions of body weight, brain weight, sleep amount, and lifespan for 54 different species of animals. Except for sleep, all distributions are strongly right-skewed, indicating the a log-transformation of the data may be appropriate.](images/q1_histograms_a.png)

<br>
<br>

### Part B

  A new dataframe was created using the log-transformations of the *Weight*, *Brain Weight*, and *Lifespan* variables and the untransformed *Sleep* variable. The histograms for the variables of this new data frame are shown in figure Q1B.
  
```{r, include=FALSE}

## Part B
lqdata <- qdata

lqdata$BodyWgt <- log(lqdata$BodyWgt)
lqdata$BrainWgt <- log(lqdata$BrainWgt)
lqdata$LifeSpan <- log(lqdata$LifeSpan)

png("images/q1_histograms_b.png",
    height = 620, width = 600)

par(mfrow = c(2,2), oma = c(0,0,4,0))

hist(lqdata$BodyWgt, 
     main = "Distribution of the Natural Log of Body Weight",
     xlab = "Body Weight (ln[kg])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$BrainWgt,
     main = "Distribution of the Natural Log of Brain Weight",
     xlab = "Brain Weight (ln[g])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$Sleep,
     main = "Distibution of Amount of Sleep",
     xlab = "Sleep (hours/day)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$LifeSpan,
     main = "Distribution of the Natural Log of Lifespan",
     xlab = "Lifespan (ln[years])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of the Observed Distributions of: \n ln(Body Weight), ln(Brain Weight), Sleep, and ln(Lifespan) for different Species",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

```

![**Figure Q1B:** The plots in the figure above show the observed distributions amount of sleep and the natural logarithms of body weight, brain weight, lifespan  for 54 different species of animals. Notice that the histograms of the natural logarithms of body weight, brain weight, and lifespan are much less right skewed than the untransformed data shown in figure Q1A.](images/q1_histograms_b.png)


<br>
<br>

### Part C

  Figure Q1C shows the plots of *Lifespan* v.s. *Brain Weight* for both the untransformed data and the log transformed data.

```{r, include = F}

## Part C
png("images/life_vs_brain.png",
    height = 480, width = 620)

par(mfrow = c(1,2), oma = c(3,0,4,0))

plot(qdata$BrainWgt, qdata$LifeSpan,
     main = "Untransformed Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)
abline(v = mean(qdata$BrainWgt), col = "blue", lwd = 1.5)
abline(h = mean(qdata$LifeSpan), col = "red", lwd = 1)

plot(lqdata$BrainWgt, lqdata$LifeSpan,
     main = "Log Tranformed Data",
     xlab = "Brain Weight (ln[g])",
     ylab = "Lifespan (ln[years])",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)
abline(v = mean(lqdata$BrainWgt), col = "blue", lwd = 1.5)
abline(h = mean(lqdata$LifeSpan), col = "red", lwd = 1)

legend(-13, -.6,
       legend = c("Mean Brain Weight   ", "Mean Lifespan"),
       lty = 1,
       col = c("blue", "red"), xpd = NA, horiz = T)

mtext(text = "Plots of Lifespan v.s. Brain Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```


![**Figure Q1C:** The plots in the figure above show how lifespan appears to increase with brain weight for both the untransformed and log transformed data. The means for the two variables are given by the red and blue lines.](images/life_vs_brain.png)

<br>
<br>

### Part D

  An estimate *r* of the true correlation $\rho$ between two variables is calculated using the following formula:
  
  $$ r = \frac{ \sum{(X_i - \bar{X})*(Y_i - \bar{Y})} } { \sqrt{\sum{(X_i - \bar{X})^2}*\sum{(Y_i - \bar{Y})^2}} } $$

  Instead of doing this by hand we used the built in R function "cor()" which takes two vectors as arguments, one for each variable. Table Q1D reports the observed correlation between *Lifespan* and *Brain Weight* for both the untransformed and log-transformed data.
  
***

```{r, echo=F, results="asis"}
## Part D
library(pander)
panderOptions("table.caption.prefix", "")

x <- data.frame("Correlation" = c(cor(qdata$BrainWgt, qdata$LifeSpan), cor(lqdata$BrainWgt, lqdata$LifeSpan)))
rownames(x) <- c("Untransformed", "Log-Transformed")

pandoc.table(x,
             caption = "**Table Q1D:** The observed correlation between lifespan and brain weight for both the untransformed and log-transformed data. Notice that the correlation for the log-transformed data is quite a bit higher than that for the untransformed data.",
             split.table = Inf)

```

***

<br>
<br>

### Part E

  Figure Q1E.1 shows the plot of the fitted regression line for the regression of *Lifespan* onto *Brain Weight* for the untransformed data along with several residual plots. From the residual plots we can see that the residuals are not uniformly scattered. Additionally from the Q-Q plot of the studentized residuals and the histogram of the studentized residuals it appears that they are *not* uniformly distributed. Thus, one of the key assumptions of the linear regression model -- that the errors are uniformly distributed with a mean of 0 and constant variance -- does not appear valid.

```{r, include=F}
## Part E

library(MASS)
library(car)

png("images/q1_ufit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

fit <- lm(LifeSpan~BrainWgt, data = qdata)

plot(qdata$BrainWgt, qdata$LifeSpan,
     main = "Fitted Regression Line",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0, 5750),
     ylim = c(0, 110),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(fit$coefficients[1], fit$coefficients[2])

plot(fit$fitted.values, fit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Lifespan Value (years)",
     ylab = "Residual",
     xlim = c(15, 75),
     ylim = c(-35, 75),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fit$fitted.values, studres(fit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Lifespan Value (years)",
     ylab = "Students Residual",
     xlim = c(15, 75),
     ylim = c(-6, 6),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fit$coefficients)-2)) 
plot(fit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.6),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit)),max(studres(fit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Lifespan onto Brain Weight: Untransformed Data",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```



![**Figure Q1E.1:** The top-left plot shows the fitted regression line and the observed data points for the regression of untransformed *Lifespan* onto *Brain Weight*. The other plots are residual analysis. From the raw residual and studentized residual plots we can clearly see that the resiudals are *not* uniformly scattered. The Cook's distance plot shows that we have some very significant outliers. In the Q-Q plot for the studentized residuals we can see that at the upper and lower tails there appear to be significant departures from normality. The histogram of the distribution of the studentized residuals show that they are skewed to the right.](images/q1_ufit.png)

<br>

  Figure Q1E.2 shows the plot of the fitted regression for the regression of the log transformed *Lifespan* and *Brain Weight* data along with several residual plots. The fit for this regression appears much better than the fit for the untransformed data (see figure Q1E.1). While the raw and studentized residuals are still not perfectly uniformly scattered, their scatter is more uniform than that for the untransformed data and there does not appear to be any obvious pattern. There are still some large outliers, as emphasized by the Cook's distance plot, but the outliers are less extreme than those observed in the regression model for the untransformed data. The histogram of the studentized residuals shows that they are still right skewed, but much less so than for the untransformed data. The Q-Q plot shows at the upper-tail that their is still some departure from normality, but overall the plot looks better than that for the untransformed data.
  
```{r, include=F}

png("images/q1_lfit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

lfit <- lm(LifeSpan~BrainWgt, data = lqdata)

plot(lqdata$BrainWgt, lqdata$LifeSpan,
     main = "Fitted Regression Line",
     xlab = "Brain Weight (log[g])",
     ylab = "Lifespan (log[years])",
     xlim = c(-2, 10),
     ylim = c(0, 5),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(lfit$coefficients[1], lfit$coefficients[2])

plot(lfit$fitted.values, lfit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Lifespan Value (log[years])",
     ylab = "Residual",
     xlim = c(0, 5),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(lfit$fitted.values, studres(lfit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Value",
     ylab = "Students Residual",
     xlim = c(0, 5),
     ylim = c(-2, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(lqdata)-length(lfit$coefficients)-2)) 
plot(lfit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(lfit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(lfit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(lfit)),max(studres(lfit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Lifespan onto Brain Weight: Untransformed Data",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```


![**Figure Q1E.2:** The top-left plot shows the fitted regression line and the observed data points for the regression of log-transformed *Lifespan* onto *Brain Weight*. The other plots are residual analysis. From the raw residual and studentized residual plots we can clearly see that the resiudals are more uniformly scattered than for the untransformed data, but still not perfectly so. The Cook's distance plot shows that we still have some very significant outliers, but they are less extreme than for the untransformed data. In the Q-Q plot for the studentized residuals we can see that at the upper tail there are still significant departures from normality, but not for the lower tail (as opposed to what we saw for the untransformed data). The histogram of the studentized residuals shows that their distribution is still somewhat skewed to the right, but much less so than for the unstransformed data.](images/q1_ufit.png)

<br>

  From figures Q1E.1 and Q1E.2 I would expect the model built from the log-transformed data to have the best overally accuracy. Although it is far from perfect, the residual diagnostics show that it is much better than the model built from the raw data.

  Figure Q2E.3 shows the plots of the fitted regression lines for both models (though in this case the log-transformed model has been transformed back from to non-log form) with the predicted *mean* life-span (or *expected* lifespan) for humans and the 95% confidence interval for this estimation. Note that we are predicting the *expected* lifespan for humans based on the model, and not the lifespan of a *specific* person. If we were predicting the lifespan for a *specific* person the 95% confidence interval would be larger. Table Q1E reports the expected human lifespan estimates for each model as well as the actual average lifespan for humans. From the table and figure it is clear that the estimates are far off from the actual expected lifespan for humans, but the estimate using the log-transformed model is the closest.

```{r, include=F}
nd <- data.frame(BodyWgt = rep(0,121), BrainWgt = seq(-2, 10, by = .1), Sleep = rep(0,121), LifeSpan = rep(0,121))
x <- seq(-2, 10, by = .1)

png("images/q1_pred.png",
    height = 480, width = 620)

par(mfrow = c(1,2), oma = c(0,0,4,1))

pL <- as.numeric(exp(predict(lfit, newdata = nd)))
pU <- as.numeric(predict(fit, newdata = exp(nd)))

plot(exp(x), pL, type = "l",
     main = "Regression Model for Transformed Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0,1500),
     ylim = c(0, 110),
     cex.lab = 1, cex.main = 1, font.main = 1)

hL <- exp(predict(lfit, lqdata["Homo sapiens",], interval = "c"))

points(qdata["Homo sapiens",2], qdata["Homo sapiens",4])
text(qdata["Homo sapiens",2] - 300, qdata["Homo sapiens",4] + 5,labels = "Homo sapiens", cex = .8)

points(qdata["Homo sapiens",2], hL[1], pch = 20, col = "red")
segments(qdata["Homo sapiens",2], hL[2], qdata["Homo sapiens",2], hL[3])
arrows(qdata["Homo sapiens",2], hL[2], qdata["Homo sapiens",2], hL[3], angle = 90, length = .1)
arrows(qdata["Homo sapiens",2], hL[3], qdata["Homo sapiens",2], hL[2], angle = 90, length = .1)


plot(exp(x), pU, type = "l",
     main = "Regression Model for Raw Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0,1500),
     ylim = c(0, 110),
     cex.lab = 1, cex.main = 1, font.main = 1)

hU <- predict(fit, qdata["Homo sapiens",], interval = "c")

points(qdata["Homo sapiens",2], qdata["Homo sapiens",4])
text(qdata["Homo sapiens",2] - 300, qdata["Homo sapiens",4] + 5,labels = "Homo sapiens", cex = .8)

points(qdata["Homo sapiens",2], hU[1], pch = 20, col = "red")
segments(qdata["Homo sapiens",2], hU[2], qdata["Homo sapiens",2], hU[3])
arrows(qdata["Homo sapiens",2], hU[2], qdata["Homo sapiens",2], hU[3], angle = 90, length = .1)
arrows(qdata["Homo sapiens",2], hU[3], qdata["Homo sapiens",2], hU[2], angle = 90, length = .1)

mtext(text = "95% Confidence Intervals for Predicted Expected Lifespan for Homo sapiens",
      outer = T,
      padj = -0.25,
      cex = 1.3,
      font = 2)

dev.off()

```

![**Figure Q2E.3:** The plots above show the 95% confidence interval for the expected lifespan of Homo sapiens according to the two models. Both estimates are very far from the actual lifespan of humans (also shown in the plots), but the model built from the untransformed data is further off.](images/q1_pred.png)

<br>

***

```{r, echo=F, results="asis"}

x <- data.frame("LP" = c(hU[1], hL[1], qdata["Homo sapiens",2]))
colnames(x) <- "Lifespan (years)"
rownames(x) <- c("Estimate from Untransformed Model", "Estimate from Log-Transformed Model", "Actual Average")

pandoc.table(x,
            caption = "**Table Q1E:** The estimated expected lifespan for each model and the actual average human lifespan.",
            split.table = Inf)

```

***

  The 

<br>
<br>

## Question 2

  See appendix [A2](#a2) for R code.

> The amount of water used by a production plant varies from month to month. Observations
on water usage and a few other, possibly related, variables were collected for 17 months
“water.txt”. The explanatory variables are the average monthly temperature, amount of
production, number of operating days in the month, number of people on the monthly plant
payroll and the number of hours the plant was shut down for maintenance. The response
variable is the monthly water usage (in gallons/100) “USAGE”. Determine an appropriate
model for predicting water usage using any or all of the 5 possible explanatory variables.
Keep in mind that the production plant is interested in developing the most parsimonious
model that is still able to efficiently predict water usage.

<br>

```{r, eval=F}

qdata <- data.frame(read.table("data/water.txt", header = T, sep = ""))

```


<br>
<br>

## Question 3

  See appendix [A3](#a3) for R code.
  
> Use the flour dataset “flour.txt” to do these problems:
>
> a. Create and print a SAS dataset or R dataframe named Flour.
> b. Use SAS or R to find the simple linear regression model for predicting NBags from
Weight.
> c. Include the relevant output in your Word file.
> d. Use SAS or R to compute the means and standard deviations for Weight and NBags.
> e. For the simple linear regression model, create the residual and normal plots.
> f. Use SAS or R to find the regression through the origin model for predicting NBags from
Weight.
> g. For the regression through the origin model, create the residual and normal plots.

### Part A

```{r}
## Part A
qdata <- data.frame(read.table("data/flour.txt", header = T, sep = ""))
colnames(qdata) <- c("weight", "nbags")

qdata
```

<br>
<br>

### Parts B and C

  The output below is the summary of the linear regression model fit using the "lm()" function in R. The p-value of 0.629 for the intercept coefficient indicates that it is not significantly non-zero.

```{r}

## Parts B and C
fit <- lm(nbags~weight, data = qdata)

summary(fit)

```


<br>
<br>

### Part D

  Table Q3D reports the means and standard deviations of *Weight* and *Nbags*.

***

```{r, echo=F, results="asis"}

## Part D

x <- data.frame(M = c(mean(qdata$weight), mean(qdata$nbags)), S = c( sqrt(var(qdata$weight)), sqrt(var(qdata$nbags)) ))
colnames(x) <- c("Mean", "Standard Deviation")
rownames(x) <- c("Weight", "Nbags")

pandoc.table(x,
             caption = "**Table Q3D:** The means and standard deviations of *Weight* and *Nbags*.",
             split.table = Inf)

```

***

<br>
<br>

### Part E

  Figure Q3E shows the residual and normal plots for the simpler linear regression model of *Nbags* regressed on *Weight* as well as the fitted regression line and observed data points.

```{r, include = F}

## Part E

png("images/q3_fit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(qdata$weight, qdata$nbags,
     main = "Fitted Regression Line",
     xlab = "Weight",
     ylab = "Nbags",
     xlim = c(4500, 30000),
     ylim = c(50, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(fit$coefficients[1], fit$coefficients[2])

plot(fit$fitted.values, fit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Residual",
     xlim = c(100, 605),
     ylim = c(-35, 55),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fit$fitted.values, studres(fit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Students Residual",
     xlim = c(100, 605),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fit$coefficients)-2)) 
plot(fit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.8),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit)),max(studres(fit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Nbags onto Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```

![**Figure Q3E:** Fitted regression line, residual plots, and normality plots for regression of Nbags on Weight.](images/q3_fit.png)

<br>
<br>

### Part F

  The output below is the summary of the linear regression model through the origin of *Nbags* regressed on *Weight*. In the previous model, which included a y-intercept of approximately -5.86, the estimated slope coefficient for *Weight* was 0.0218. In the model through the origin the slope coefficient is slightly smaller, approximately 0.0215.

```{r}

## Part F
fito <- lm(nbags~0 + weight, data = qdata)

summary(fito)

```

<br>
<br>

### Part G

  Figure Q3G shows the residual and normal plots for the simpler linear regression model **passing through the origin** of *Nbags* regressed on *Weight* as well as the fitted regression line and observed data points.

```{r, include = F}

## Part G

png("images/q3_fito.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(qdata$weight, qdata$nbags,
     main = "Fitted Regression Line",
     xlab = "Weight",
     ylab = "Nbags",
     xlim = c(4500, 30000),
     ylim = c(50, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(0, fito$coefficients[1])

plot(fito$fitted.values, fito$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Residual",
     xlim = c(100, 605),
     ylim = c(-35, 55),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fito$fitted.values, studres(fito),
     main = "Studentized Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Students Residual",
     xlim = c(100, 605),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fito$coefficients)-2)) 
plot(fito, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fito, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fito) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.8),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fito)),max(studres(fito)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression through the Origin: Nbags onto Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```

![**Figure Q3%:** Fitted regression line, residual plots, and normality plots for the regression model of Nbags on Weight passing through the origin.](images/q3_fito.png)

<br>
<br>

## Question 4

  See appendix [A4](#a4) for R code.

> The data are from a hypothetical Verbal Learning Experiment in which participants with Low
Anxiety levels and High Anxiety levels are given a verbal learning task “anxiety.txt”. Some
are given instructions to induce little if any pressure. Some are given instructions to induce
moderation pressure to perform well. Others are given instructions to induce strong
pressure to perform well. Assume that all assumptions for Two-Way ANOVA model are
met.
>
> a. Is there a Main Effect of Anxiety. Do high anxious persons perform better or worse than low
anxious?
> b. Is there a Main Effect of Pressure. Overall, do persons under different amounts of pressure
perform this task differently?
> c. Is there an Interaction of Anxiety and Pressure: Do performance differences between anxiety
levels change at different levels of pressure? Or do the effects of different levels of pressure
differ for people with high anxiety vs. low anxiety?

### Part A

  If we assume that low anxiety is coded as *1* in the data set and high anxiety is coded as *2* we can see that anxious persons perform worse. This is because the mean score for high anxiety people (coded as *2*) is lower than the mean score for low anxiety people (coded as *1*). Table Q4A reports the mean test scores for high anxiety and low anxiety people.

***

```{r, echo = F, results="asis"}

## Part A
qdata <- data.frame(read.table("data/anxiety.txt", header = T, sep = ""))
qdata$anxiety <- factor(qdata$anxiety)
qdata$pressure <- factor(qdata$pressure)

x <- data.frame(M = c(mean(qdata$verblearn[qdata$anxiety==1]), mean(qdata$verblearn[qdata$anxiety==2])))
colnames(x) <- "Mean Test Score"
rownames(x) <- c("Low Anxiety", "High Anxiety")

pandoc.table(x,
             caption = "**Table Q4A:** Mean test scores for low anxiety and high anxiety individuals",
             split.table = Inf)

```

***

  We can do a one-way ANOVA test in R using the "aov()" function. The output for this function when looking at the effect of *Anxiety* on the learning scores is shown below. The low p-value (less than 0.01) indicates that there is indeed a non-zero factor effect of *Anxiety* on learning scores. Since the mean scores are higher for low anxiety people and the ANOVA test confirms that there is a difference between high and low anxiety individuals we conclude that low anxiety individuals perform better than high anxiety individuals.

```{r}
fit <- aov(verblearn ~ anxiety, data = qdata)
summary(fit)
```


<br>
<br>

### Part B

  Table Q4B reports the mean learning scores for individuals under low pressure, medium pressure, and high pressure. We are assuming that low pressure is coded as *1* in the data set and high pressure as *3*.

***

```{r, echo = F, results="asis"}

## Part B
x <- data.frame(M = c(mean(qdata$verblearn[qdata$pressure==1]), mean(qdata$verblearn[qdata$pressure==2]), mean(qdata$verblearn[qdata$pressure==3])))
colnames(x) <- "Mean Test Score"
rownames(x) <- c("Low Pressure", "Medium Pressure", "High Pressure")

pandoc.table(x,
             caption = "**Table Q4B:** Mean test scores for individuals under low, medium, and high pressure.",
             split.table = Inf)

```

***

<br>

  Table Q4B shows that the mean scores were higher for individuals under hight pressure. We will use the "aov()" function in R to see if there is actually a significant difference between any of the levels of pressure. Since the p-value is greater than 0.05 we cannot conclude that pressure has a significant effect on performance.
  
```{r}
fit <- aov(verblearn ~ pressure, data = qdata)
summary(fit)
```

<br>
<br>

### Part C

  Table Q4C reports the mean learning scores for low and high anxiety individuals under low pressure, medium pressure, and high pressure.

***

```{r, echo = F, results="asis"}

## Part C
x <- data.frame(L = c(mean(qdata$verblearn[qdata$pressure==1 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==1 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==1])),
                M = c(mean(qdata$verblearn[qdata$pressure==2 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==2 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==2])),
                H = c(mean(qdata$verblearn[qdata$pressure==3 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==3 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==3])),
                A = c(mean(qdata$verblearn[qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$anxiety==2]), 
                      mean(qdata$verblearn)))

colnames(x) <- c("Low Pressure", "Medium Pressure", "High Pressure", "Total")
rownames(x) <- c("Low Anxiety", "High Anxiety", "Total")

pandoc.table(x,
             caption = "**Table Q4B:** Mean test scores for high and low anxiety individuals under low, medium, and high pressure.",
             split.table = Inf)

```

***

<br>

  We can also use the R function "aov()" to perform a two-way ANOVA test. Since the p-value of interaction between *Anxiety* and *Pressure* is less than 0.05 we can conclude at a 5% signifcance level that there is an interaction between anxiety and pressure on scores. This means that the effects of different levels of pressure on performance differ between high anxiety and low anxiety individuals, and the effect of anxiety on performance varies at different levels of pressure. 

```{r}
## Part C
fit <- aov(verblearn ~ anxiety*pressure, data = qdata)
summary(fit)
```

  Now that we know there is an interaction between *Anxiety* and *Pressure* we want to see which levels actually differ. To this end we will perform Tukey's Honestly Significant Difference (HSD) test. The output below shows that in addition to there being a differenc between high and low anxiety people (which we alread showed in part A), there are some differences between groups of different *combinations* of anxiety and pressure levels. 
  
  The p-value of ~0.021 for "1:3-1:1" (*Anxiety*:*Pressure*) indicates that there is a significant difference for low anxiety people when under high pressure and low pressure. The "diff" column in the output indicates the estimated difference between the two groups. So low anxiety individuals are estimated to score about 13.4 points better when under high pressure than when under low pressure. However, the 95% confidence interval (lower bound given in column "lwr", upper bound given in column "upr") for the difference is large. The p-value of ~0.00031 for "1:3-2:1" indicates that there is a significant difference between low anxiety people under high pressure and high anxiety people under low pressure. Low anxiety people under high pressure are estimated to score 19 points better (95% CI: 6.9 - 13.1) than high anxiety people under low pressure. The p-value of ~0.0087 for "1:3-2:2" indicates that there is a significant difference in performance between low anxiety people under high pressure and high anxiety people under medium pressure. Low anxiety people under high pressure are estimated to score 14.7 points better (95% CI: 2.6 - 26.8) than high anxiety people under medium pressure. Finally, the p-value of ~0.00024 for "2:3-1:3" indicates that there is a significant difference between low anxiety people under high pressure and high anxiety people under high pressure. High anxiety people under high pressure are estimated to do 19.3 points (95% CI: 7.2 - 31.4) *worse* than low anxiety people under high pressure.

```{r}
TukeyHSD(fit)
```
  

Figure Q4C gives a nice visualization of the interaction effects between *Anxiety* and *Pressure*. The combination of low anxiety and high pressure performs best on the test (this can also be seen from the output of the Tukey's HSD test). The effect of pressure on performance is much greater for low anxiety people than high anxiety people.

```{r, include=F}
png("images/q4_int.png",
    width = 480, height = 480)

par(oma = c(1,1,1,1))

interaction.plot(qdata$pressure, qdata$anxiety, qdata$verblearn,
                 trace.label = "Anxiety",
                 type = "b", col = c("darkmagenta", "forestgreen"),
                 leg.bty = "o", leg.bg = "beige", lwd = 2, pch = c(20, 24),
                 xlab = "Pressure", 
                 ylab = "Learning Score",
                 main = "Interaction Plot")

dev.off()

```

![**Figure Q4C:** Interaction plot showing the effect of pressure on test scores for different anxiety level individuals. Pressure appears to affect low anxiety people positively but doesn't seem to have much of an effect on high anxiety people.](images/q4_int.png)

<br>
<br>

## Question 5

  See appendix [A5](#a5) for R code.
  
> Researchers were interested in determining the relationship between a person’s cholesterol
level and their age and gender. For each of 30 subjects, data was collected on their
cholesterol level (in mg), age group (Under 30, 30-50, Over 50) and gender
“CholesterolLevel.txt”. Fit an appropriate model to the data set. Justify your choice carefully.
Determine whether there is a significant age or gender difference in the mean cholesterol
levels. Also determine whether or not the two factors interact with one another.

  First we loaded the data set and converted the string values for *Age Group* and *Gender* into factors such that:
  
* *Age Group* Levels
    1. Under 30
    2. 30-50
    3. Over 50
* *Gender* Levels
    1. Female
    2. Male
    
```{r, include=F}

q5data <- data.frame(read.delim("data/CholesterolLevel2.txt", header = T, sep = "\t"))
q5data$Age.Group <- factor(q5data$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
q5data$Gender <- factor(q5data$Gender)

```

  
  Since we converted the variables *Age Group* and *Gender* to factors with different levels (three for *Age Group* and two for *Gender*), the linear regression model fitting function "lm()" in R will automatically treat the lowest factor level as the baseline. So the baseline for *Age Group* is "30-50" and the baseline fore *Gender* is female. Fitting a linear regression model (including interaction terms), we find that *Gender* has a significant effect (p-value = 0.05) as well as the interaction between *Gender* and the *Age Group* level of "Over 50" (p-value < 0.05). Except for this interaction, *Age Group* does not have a significant effect on *Cholesterol* level.

<br>

```{r}
fit1 <- lm(Cholesterol ~ Gender + Age.Group + Gender:Age.Group, data = q5data)
summary(fit1)
```

<br>
  
  Since the only level of *Age Group* that seemed to be significant in the above model was the group over 50 (when interacting with *Gender*), we collapsed the *Age Group* levels "Under 30" and "30-50" into one level and fit a model to this data. In this simplified model we find that the same factors and interactions are significant, but now the coefficient for the intercept is also significant (p-value < 0.05) which it was not in the previous model (p-value ~0.08).

```{r}
q5data.2 <- q5data
q5data.2$Age.Group <- as.character(q5data.2$Age.Group)
q5data.2$Age.Group[q5data$Age.Group == "30-50" | q5data$Age.Group == "Under 30"] <- "Under 50"
q5data.2$Age.Group <- factor(q5data.2$Age.Group, levels = c("Under 50", "Over 50"))

fit2 <- lm(Cholesterol ~ Gender + Age.Group + Gender:Age.Group, data = q5data.2)
summary(fit2)

```

<br>

  Figures Q51 and Q52 show the fitted linear regression model, residual plots, and normality plots for the two models. Figure Q51 shows the plots for model including all levels of *Age Group*, while figure Q52 shows the plots for the model with the "Under 30" and "30-50" levels collapsed.

```{r, include=F}

png("images/q5_fit1.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(as.numeric(q5data$Age.Group[q5data$Gender == "Female"]), q5data$Cholesterol[q5data$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(1, 3),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data$Age.Group[q5data$Gender == "Male"]), q5data$Cholesterol[q5data$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 30", "30 - 50", "Over 50"), at = c(1,2,3), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Male", 3), Cholesterol = rep(0,3))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Female", 3), Cholesterol = rep(0,3))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- predict(fit1, newdata = nd.m)
pf <- predict(fit1, newdata = nd.f)

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit1$fitted.values, fit1$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Cholesterol Level (mg)",
     ylab = "Residual",
     xlim = c(200, 610),
     ylim = c(-375, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit1$fitted.values, studres(fit1),
     main = "Studentized Residual Plot",
     xlab = "Fitted Cholesterol (mg)",
     ylab = "Students Residual",
     xlim = c(200, 610),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data)-length(fit1$coefficients)-2)) 
plot(fit1, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit1, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit1) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit1)),max(studres(fit1)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Cholesterol Level onto Age Group and Gender",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()


```

![**Figure Q51:** Fitted linear regression model, residual plots, and normality plots for the linear regression of cholesterol level onto *Age Group* and *Gender* using all levels of *Age Group*. The residual plots show that there seems to be more variation for higher predicted cholesterol levels. The Q-Q plot looks pretty good except for the upper tail. The histogram of the studentized residuals shows that the distribution of the residuals is right-skewed.](images/q5_fit1.png)

<br>

```{r, include=F}

png("images/q5_fit2.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,5.5,0))

plot(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Female"]), q5data.2$Cholesterol[q5data.2$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(0.8,2.2),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Male"]), q5data.2$Cholesterol[q5data.2$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 50", "Over 50"), at = c(1,2), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Male", 2), Cholesterol = rep(0,2))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Female", 2), Cholesterol = rep(0,2))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- predict(fit2, newdata = nd.m)
pf <- predict(fit2, newdata = nd.f)

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit2$fitted.values, fit2$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Cholesterol Level (mg)",
     ylab = "Residual",
     xlim = c(200, 500),
     ylim = c(-375, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit2$fitted.values, studres(fit2),
     main = "Studentized Residual Plot",
     xlab = "Fitted Cholesterol (mg)",
     ylab = "Students Residual",
     xlim = c(200, 500),
     ylim = c(-4, 4.5),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data.2)-length(fit2$coefficients)-2)) 
plot(fit2, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit2, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit2) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.6),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit2)-1),max(studres(fit2)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Cholesterol Level onto Age Group and Gender: \n Age Groups \"Under 30\" and \"30-50\" Collapsed",
      outer = T,
      padj = 0,
      cex = 1.2, font = 2)

dev.off()


```

![**Figure Q52:** Fitted linear regression model, residual plots, and normality plots for the linear regression of cholesterol level onto *Age Group* and *Gender* with the "Under 30" and "30-50" levels of *Age Group* collapsed together. The residual plots look quite similar to those for the regression model with uncollapsed *Age Group* levels. The normality plots are also quite similar though there is greater deviation from the normal at the upper tail of the Q-Q plot which can also be seen in the histogram of the residuals which are slightly more right skewed.](images/q5_fit2.png)

<br>


  Before we proceed further, we will take a look at the distribution of observed cholesterol levels. Figure Q53 shows histograms of the raw untransformed obeserved *Cholesterol* values as well as the log-transformed *Cholesterol* values. We can clearly see that the distribution of the untransformed data is right-skewed, while the distribution of the log-transformed data appears more normally distributed.

```{r include=F}

png("images/q5_histograms_a.png",
    height = 480, width = 600)

par(mfrow = c(1,2), oma = c(0,0,4,0))

hist(q5data$Cholesterol, 
     main = "Distribution of Cholesterol Levels",
     xlab = "Cholesterol Level (mg)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(log(q5data$Cholesterol),
     main = "Distribution of ln[Cholesterol] Levels",
     xlab = "Cholesterol Level (ln[mg])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of Untransformed and Log-Transformed Cholesterol Data",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

```
 
![**Figure Q53:** The histograms above show the distributions of the untransformed and log-transformed cholesterol data. The untransformed data is much more right-skewed than the log-transformed data.](images/q5_histograms_a.png) 
 
<br>

  Running Shapiro-Wilk tests for normality (using the "shapiro.test()" function in R) concluded our suspicions from the histograms shown in figure Q51. Table Q51 reports the p-values for the Shapiro-Wilk tests for the untransformed and log-transformed *Cholesterol* data. The small p-value (< 0.05) for the untransformed data indicates that we should reject the null hypothesis that the untransformed *Cholesterol* data are normally distributed and conclude that the untransformed data are not normally distributed. On the other hand the large p-value for the log-transformed data (>0.05) indicates that we should accept the null hypothesis that the data are normally distributed, thus we can safely assume the log-transformed *Cholesterol* data are approximately normally distributed.
  
***
  
```{r, results="asis"}

x <- data.frame(P = c(shapiro.test(q5data$Cholesterol)$p.value, 
                      shapiro.test(log(q5data$Cholesterol))$p.value))
colnames(x) <- "P-Value"
rownames(x) <- c("Untransformed Cholesterol Data", "Log-Transformed Cholesterol Data")

pandoc.table(x,
             caption = "**Table Q51:** Shapiro-Wilk normality test results for untransformed and log-transformed cholesterol data. The p-value of less than 0.05 for the untransformed data means we should reject the assumption that the unstransformed data are normally distributed. Conversely, the p-value of more than 0.05 for the log-transformed data indicates that we can accept the assumption that the log-transformed cholesterol data are normally distributed",
             split.table = Inf)

```

***

<br>

  We will now try and regress the log-transformed *Cholesterol* data onto *Age Group* and *Gender* and see if we can get any better fit. Below is the output for the model fitting with all levels of *Age Group*. As before we see that *Age Group* is only significant at one level and then only when interacting with *Gender*. *Gender* is still significant and the coefficient for the intercept is also no significant.

```{r}
fit1l <- lm(log(Cholesterol) ~ Gender + Age.Group + Gender:Age.Group, data = q5data)
summary(fit1l)
```

<br>  
  
  Now lets look at the linear regression of the log-transformed *Cholesterol* data onto *Gender* and *Age Group* with the two youngest levels of *Age Group* collapsed together. The same parameters are significant at a significance level of 5% as the collapsed model for the untransformed data, but the p-values are slightly different.
  
```{r}
fit2l <- lm(log(Cholesterol) ~ Gender + Age.Group + Gender:Age.Group, data = q5data.2)
summary(fit2l)
```

<br>

  Now lets take a look at the residual and normality plots for the log-transformed regressions. Figure Q54 shows the fitted regression model, residual plots, and normality plots for the linear regression of the log-transformed *Cholesterol* data onto *Gender* and *Age Group* using all levels of *Age Group*. Figure Q55 shows the same plots but for the regression model with the two youngest age groups collapsed together.

```{r, include=F}

png("images/q5_fitl1.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(as.numeric(q5data$Age.Group[q5data$Gender == "Female"]), q5data$Cholesterol[q5data$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(1, 3),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data$Age.Group[q5data$Gender == "Male"]), q5data$Cholesterol[q5data$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 30", "30 - 50", "Over 50"), at = c(1,2,3), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Male", 3), Cholesterol = rep(0,3))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Female", 3), Cholesterol = rep(0,3))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- exp(predict(fit1l, newdata = nd.m))
pf <- exp(predict(fit1l, newdata = nd.f))

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit1l$fitted.values, fit1l$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Residual",
     xlim = c(5, 6),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit1l$fitted.values, studres(fit1l),
     main = "Studentized Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Students Residual",
     xlim = c(5, 6),
     ylim = c(-3, 3),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data)-length(fit1l$coefficients)-2)) 
plot(fit1l, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit1l, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit1l) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit1l)-1),max(studres(fit1l)+1),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Log Transformed Cholesterol Level onto Age Group and Gender",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()


```

![**Figure Q54:** Fitted linear regression model, residual plots, and normality plots for the linear regression of log-transformed cholesterol level onto *Age Group* and *Gender* using all levels of *Age Group*. The scatter on the residual plots seems to be a little more random than that observed for the untransformed data but there is still a slight pattern, the residuals for smaller fitted values seem to be larger overall. However the normality plots are much better than those observed for the regression of the untransformed data. All the residuals lie close to the normal line in the Q-Q plot and the histogram of the residuals show that they are appear to be very close to normally distributed.](images/q5_fitl1.png)  
 
<br>

```{r, include=F}

png("images/q5_fitl2.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,6,0))

plot(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Female"]), q5data.2$Cholesterol[q5data.2$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(0.9, 2.1),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Male"]), q5data.2$Cholesterol[q5data.2$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 50", "Over 50"), at = c(1,2), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Male", 2), Cholesterol = rep(0,2))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Female", 2), Cholesterol = rep(0,2))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- exp(predict(fit2l, newdata = nd.m))
pf <- exp(predict(fit2l, newdata = nd.f))

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit2l$fitted.values, fit2l$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Residual",
     xlim = c(5, 6),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit2l$fitted.values, studres(fit2l),
     main = "Studentized Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Students Residual",
     xlim = c(5, 6),
     ylim = c(-3, 3),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data.2)-length(fit2l$coefficients)-2)) 
plot(fit2l, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit2l, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit2l) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit2l)-1),max(studres(fit2l)+1),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Log Transformed Cholesterol Level onto Age Group and Gender: \n Age Groups \"Under 30\" and \"30-50\" Collapsed",
      outer = T,
      padj = 0,
      cex = 1.2, font = 2)

dev.off()


```
 
![**Figure Q55:** Fitted linear regression model, residual plots, and normality plots for the linear regression of log-transformed cholesterol level onto *Age Group* and *Gender* with the two youngest age groups collapsed. The scatter on the residual plots seems a bit more uniform that that observed on the residual plots for the model using all levels of *Age Group*, but the spread variance does seem larger overall. As with the model including all levels of *Age Group* the normality plots show that the residuals appear to be normally distributed.](images/q5_fitl2.png)  
  
<br>

  In both figures Q54 and Q55 the normality plots show that the residuals appear to be normally distributed with all the residuals lying close to the normal line in the Q-Q plot and the histogram of the residuals showing an approximatly normal distribution. The residual plots in figure Q55 show more uniform scatter than those in Q54 indicating that there is less pattern (and thus less heteroskedacity) in the error of the model with the two youngest levels of *Age Group* collapsed. Both models appear to be improvements over the models using the untransformed *Cholesterol* data.

  Before choosing between the two models let's look at the R summary output for both models. Below, the summary for the log-transformed model with all levels of *Age Group* is given first and the log-transformed model with the youngest levels of *Age Group* collapsed is given second.

```{r}
summary(fit1l)

summary(fit2l)
```

<br>

  I would recommend using the model with the two youngest levels of *Age Group* collapsed primarily because it is the simpler model of the two and when looking at the residual and normality plots both models perform about equally (see figures Q54 and Q55). Additionally, even though it is the simpler model, it has a slightly larger adjusted R-squared value, slightly smaller residual standard error, and the p-value of the F-statistic is smaller.
  
  In conclusion, there does seem to be significant association between gender and cholesterol level, males appear to have higher overall cholesterol levels than females. Additionally, although there does not seem to be an overall effect of age on cholesterol, there is an interactive effect between gender and age. Males over the age of fifty appear to have lower cholesterol levels than females over the age of 50.



<br>
<br>

## Question 6

  See appendix [A6](#a6) for R code.

> A hospital surgical unit was interested in predicting survival time in patients undergoing a
particular type of liver operation. From a random sample of 54 patients, information on the
patient’s survival time, blood clotting score, prognostic index, enzyme function test score and
liver function test score were extracted “Surgical.txt”.
>
>a. Fit a multiple regression model using the natural logarithm of survival time as the response
variable and the other four variables as explanatory variables.
>b. Conduct an F-test for the overall fit of the regression model in (a). Comment on the results.
>c. Test each of the individual regression coefficients. Do the results indicate that any of the
explanatory variables can be removed from the model?
>d. Perform variable selection by finding the subset model that minimizes the BIC criteria. State
the ‘best’ model.
>e. Using the model from part (d) make appropriate diagnostic plots to determine whether the
model assumptions are valid. Comment on the plots.















<br>
<br>

# Appendix


<br>

## A1
```{r}
## Import data

qdata <- data.frame(read.table("data/sleep.txt", header = T, sep = ""))

rownames(qdata) <- qdata$Species

qdata <- qdata[,2:5]

#######################################################################

## Part A
png("images/q1_histograms_a.png",
    height = 620, width = 600)

par(mfrow = c(2,2), oma = c(0,0,4,0))

hist(qdata$BodyWgt, 
     main = "Distribution of Body Weight",
     xlab = "Body Weight (kg)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$BrainWgt,
     main = "Distribution of Brain Weight",
     xlab = "Brain Weight (g)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$Sleep,
     main = "Distibution of Amount of Sleep",
     xlab = "Sleep (hours/day)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(qdata$LifeSpan,
     main = "Distribution of Lifespan",
     xlab = "Lifespan (years)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of the Observed Distributions of: \n Body Weight, Brain Weight, Sleep, and Lifespan for different Species",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

#######################################################################

## Part B
lqdata <- qdata

lqdata$BodyWgt <- log(lqdata$BodyWgt)
lqdata$BrainWgt <- log(lqdata$BrainWgt)
lqdata$LifeSpan <- log(lqdata$LifeSpan)

png("images/q1_histograms_b.png",
    height = 620, width = 600)

par(mfrow = c(2,2), oma = c(0,0,4,0))

hist(lqdata$BodyWgt, 
     main = "Distribution of the Natural Log of Body Weight",
     xlab = "Body Weight (ln[kg])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$BrainWgt,
     main = "Distribution of the Natural Log of Brain Weight",
     xlab = "Brain Weight (ln[g])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$Sleep,
     main = "Distibution of Amount of Sleep",
     xlab = "Sleep (hours/day)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(lqdata$LifeSpan,
     main = "Distribution of the Natural Log of Lifespan",
     xlab = "Lifespan (ln[years])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of the Observed Distributions of: \n ln(Body Weight), ln(Brain Weight), Sleep, and ln(Lifespan) for different Species",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

#######################################################################

## Part C
png("images/life_vs_brain.png",
    height = 480, width = 620)

par(mfrow = c(1,2), oma = c(3,0,4,0))

plot(qdata$BrainWgt, qdata$LifeSpan,
     main = "Untransformed Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)
abline(v = mean(qdata$BrainWgt), col = "blue", lwd = 1.5)
abline(h = mean(qdata$LifeSpan), col = "red", lwd = 1)

plot(lqdata$BrainWgt, lqdata$LifeSpan,
     main = "Log Tranformed Data",
     xlab = "Brain Weight (ln[g])",
     ylab = "Lifespan (ln[years])",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)
abline(v = mean(lqdata$BrainWgt), col = "blue", lwd = 1.5)
abline(h = mean(lqdata$LifeSpan), col = "red", lwd = 1)

legend(-13, -.6,
       legend = c("Mean Brain Weight   ", "Mean Lifespan"),
       lty = 1,
       col = c("blue", "red"), xpd = NA, horiz = T)

mtext(text = "Plots of Lifespan v.s. Brain Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

#######################################################################

## Part D
library(pander)
panderOptions("table.caption.prefix", "")

x <- data.frame("Correlation" = c(cor(qdata$BrainWgt, qdata$LifeSpan), cor(lqdata$BrainWgt, lqdata$LifeSpan)))
rownames(x) <- c("Untransformed", "Log-Transformed")

pandoc.table(x,
             caption = "**Table Q1D:** The observed correlation between lifespan and brain weight for both the untransformed and log-transformed data. Notice that the correlation for the log-transformed data is quite a bit higher than that for the untransformed data.",
             split.table = Inf)

#######################################################################

## Part E
library(MASS)
library(car)

png("images/q1_ufit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

fit <- lm(LifeSpan~BrainWgt, data = qdata)

plot(qdata$BrainWgt, qdata$LifeSpan,
     main = "Fitted Regression Line",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0, 5750),
     ylim = c(0, 110),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(fit$coefficients[1], fit$coefficients[2])

plot(fit$fitted.values, fit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Lifespan Value (years)",
     ylab = "Residual",
     xlim = c(15, 75),
     ylim = c(-35, 75),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fit$fitted.values, studres(fit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Lifespan Value (years)",
     ylab = "Students Residual",
     xlim = c(15, 75),
     ylim = c(-6, 6),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fit$coefficients)-2)) 
plot(fit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.6),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit)),max(studres(fit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Lifespan onto Brain Weight: Untransformed Data",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()



png("images/q1_lfit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

lfit <- lm(LifeSpan~BrainWgt, data = lqdata)

plot(lqdata$BrainWgt, lqdata$LifeSpan,
     main = "Fitted Regression Line",
     xlab = "Brain Weight (log[g])",
     ylab = "Lifespan (log[years])",
     xlim = c(-2, 10),
     ylim = c(0, 5),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(lfit$coefficients[1], lfit$coefficients[2])

plot(lfit$fitted.values, lfit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Lifespan Value (log[years])",
     ylab = "Residual",
     xlim = c(0, 5),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(lfit$fitted.values, studres(lfit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Value",
     ylab = "Students Residual",
     xlim = c(0, 5),
     ylim = c(-2, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(lqdata)-length(lfit$coefficients)-2)) 
plot(lfit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(lfit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(lfit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(lfit)),max(studres(lfit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Lifespan onto Brain Weight: Untransformed Data",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()



nd <- data.frame(BodyWgt = rep(0,121), BrainWgt = seq(-2, 10, by = .1), Sleep = rep(0,121), LifeSpan = rep(0,121))
x <- seq(-2, 10, by = .1)

png("images/q1_pred.png",
    height = 480, width = 620)

par(mfrow = c(1,2), oma = c(0,0,4,1))

pL <- as.numeric(exp(predict(lfit, newdata = nd)))
pU <- as.numeric(predict(fit, newdata = exp(nd)))

plot(exp(x), pL, type = "l",
     main = "Regression Model for Transformed Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0,1500),
     ylim = c(0, 110),
     cex.lab = 1, cex.main = 1, font.main = 1)

hL <- exp(predict(lfit, lqdata["Homo sapiens",], interval = "c"))

points(qdata["Homo sapiens",2], qdata["Homo sapiens",4])
text(qdata["Homo sapiens",2] - 300, qdata["Homo sapiens",4] + 5,labels = "Homo sapiens", cex = .8)

points(qdata["Homo sapiens",2], hL[1], pch = 20, col = "red")
segments(qdata["Homo sapiens",2], hL[2], qdata["Homo sapiens",2], hL[3])
arrows(qdata["Homo sapiens",2], hL[2], qdata["Homo sapiens",2], hL[3], angle = 90, length = .1)
arrows(qdata["Homo sapiens",2], hL[3], qdata["Homo sapiens",2], hL[2], angle = 90, length = .1)


plot(exp(x), pU, type = "l",
     main = "Regression Model for Raw Data",
     xlab = "Brain Weight (g)",
     ylab = "Lifespan (years)",
     xlim = c(0,1500),
     ylim = c(0, 110),
     cex.lab = 1, cex.main = 1, font.main = 1)

hU <- predict(fit, qdata["Homo sapiens",], interval = "c")

points(qdata["Homo sapiens",2], qdata["Homo sapiens",4])
text(qdata["Homo sapiens",2] - 300, qdata["Homo sapiens",4] + 5,labels = "Homo sapiens", cex = .8)

points(qdata["Homo sapiens",2], hU[1], pch = 20, col = "red")
segments(qdata["Homo sapiens",2], hU[2], qdata["Homo sapiens",2], hU[3])
arrows(qdata["Homo sapiens",2], hU[2], qdata["Homo sapiens",2], hU[3], angle = 90, length = .1)
arrows(qdata["Homo sapiens",2], hU[3], qdata["Homo sapiens",2], hU[2], angle = 90, length = .1)

mtext(text = "95% Confidence Intervals for Predicted Expected Lifespan for Homo sapiens",
      outer = T,
      padj = -0.25,
      cex = 1.3,
      font = 2)

dev.off()



x <- data.frame("LP" = c(hU[1], hL[1], qdata["Homo sapiens",2]))
colnames(x) <- "Lifespan (years)"
rownames(x) <- c("Estimate from Untransformed Model", "Estimate from Log-Transformed Model", "Actual Average")

pandoc.table(x,
            caption = "**Table Q1E:** The estimated expected lifespan for each model and the actual average human lifespan.",
            split.table = Inf)

```


<br>
<br>

## A2

<br>
<br>

## A3

```{r}
## Part A
qdata <- data.frame(read.table("data/flour.txt", header = T, sep = ""))
colnames(qdata) <- c("weight", "nbags")

qdata

#######################################################################

## Parts B and C
fit <- lm(nbags~weight, data = qdata)

summary(fit)

#######################################################################

## Part D

x <- data.frame(M = c(mean(qdata$weight), mean(qdata$nbags)), S = c( sqrt(var(qdata$weight)), sqrt(var(qdata$nbags)) ))
colnames(x) <- c("Mean", "Standard Deviation")
rownames(x) <- c("Weight", "Nbags")

pandoc.table(x,
             caption = "**Table Q3D:** The means and standard deviations of *Weight* and *Nbags*.",
             split.table = Inf)

#######################################################################

## Part E

png("images/q3_fit.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(qdata$weight, qdata$nbags,
     main = "Fitted Regression Line",
     xlab = "Weight",
     ylab = "Nbags",
     xlim = c(4500, 30000),
     ylim = c(50, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(fit$coefficients[1], fit$coefficients[2])

plot(fit$fitted.values, fit$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Residual",
     xlim = c(100, 605),
     ylim = c(-35, 55),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fit$fitted.values, studres(fit),
     main = "Studentized Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Students Residual",
     xlim = c(100, 605),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fit$coefficients)-2)) 
plot(fit, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fit, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fit) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.8),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit)),max(studres(fit)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Nbags onto Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

#######################################################################

## Part F
fito <- lm(nbags~0 + weight, data = qdata)

summary(fito)

#######################################################################

## Part G

png("images/q3_fito.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(qdata$weight, qdata$nbags,
     main = "Fitted Regression Line",
     xlab = "Weight",
     ylab = "Nbags",
     xlim = c(4500, 30000),
     ylim = c(50, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(0, fito$coefficients[1])

plot(fito$fitted.values, fito$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Residual",
     xlim = c(100, 605),
     ylim = c(-35, 55),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

plot(fito$fitted.values, studres(fito),
     main = "Studentized Residual Plot",
     xlab = "Fitted Weight",
     ylab = "Students Residual",
     xlim = c(100, 605),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

cutoff <- 4/((nrow(qdata)-length(fito$coefficients)-2)) 
plot(fito, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

qqPlot(fito, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 2)

hist(studres(fito) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.8),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fito)),max(studres(fito)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression through the Origin: Nbags onto Weight",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

```

<br>
<br>

## A4

```{r}
## Part A
qdata <- data.frame(read.table("data/anxiety.txt", header = T, sep = ""))
qdata$anxiety <- factor(qdata$anxiety)
qdata$pressure <- factor(qdata$pressure)

x <- data.frame(M = c(mean(qdata$verblearn[qdata$anxiety==1]), mean(qdata$verblearn[qdata$anxiety==2])))
colnames(x) <- "Mean Test Score"
rownames(x) <- c("Low Anxiety", "High Anxiety")

pandoc.table(x,
             caption = "**Table Q4A:** Mean test scores for low anxiety and high anxiety individuals",
             split.table = Inf)


fit <- aov(verblearn ~ anxiety, data = qdata)
summary(fit)

################################################################

## Part B
x <- data.frame(M = c(mean(qdata$verblearn[qdata$pressure==1]), mean(qdata$verblearn[qdata$pressure==2]), mean(qdata$verblearn[qdata$pressure==3])))
colnames(x) <- "Mean Test Score"
rownames(x) <- c("Low Pressure", "Medium Pressure", "High Pressure")

pandoc.table(x,
             caption = "**Table Q4B:** Mean test scores for individuals under low, medium, and high pressure.",
             split.table = Inf)


fit <- aov(verblearn ~ pressure, data = qdata)
summary(fit)

################################################################

## Part C
x <- data.frame(L = c(mean(qdata$verblearn[qdata$pressure==1 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==1 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==1])),
                M = c(mean(qdata$verblearn[qdata$pressure==2 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==2 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==2])),
                H = c(mean(qdata$verblearn[qdata$pressure==3 & qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$pressure==3 & qdata$anxiety==2]),
                      mean(qdata$verblearn[qdata$pressure==3])),
                A = c(mean(qdata$verblearn[qdata$anxiety==1]), 
                      mean(qdata$verblearn[qdata$anxiety==2]), 
                      mean(qdata$verblearn)))

colnames(x) <- c("Low Pressure", "Medium Pressure", "High Pressure", "Total")
rownames(x) <- c("Low Anxiety", "High Anxiety", "Total")

pandoc.table(x,
             caption = "**Table Q4B:** Mean test scores for high and low anxiety individuals under low, medium, and high pressure.",
             split.table = Inf)


fit <- aov(verblearn ~ anxiety*pressure, data = qdata)
summary(fit)


TukeyHSD(fit)


png("images/q4_int.png",
    width = 480, height = 480)

par(oma = c(1,1,1,1))

interaction.plot(qdata$pressure, qdata$anxiety, qdata$verblearn,
                 trace.label = "Anxiety",
                 type = "b", col = c("darkmagenta", "forestgreen"),
                 leg.bty = "o", leg.bg = "beige", lwd = 2, pch = c(20, 24),
                 xlab = "Pressure", 
                 ylab = "Learning Score",
                 main = "Interaction Plot")

dev.off()

```

<br>
<br>

## A5

```{r}

q5data <- data.frame(read.delim("data/CholesterolLevel2.txt", header = T, sep = "\t"))
q5data$Age.Group <- factor(q5data$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
q5data$Gender <- factor(q5data$Gender)

################################################################

fit1 <- lm(Cholesterol ~ Gender + Age.Group + Gender:Age.Group, data = q5data)
summary(fit1)

################################################################

q5data.2 <- q5data
q5data.2$Age.Group <- as.character(q5data.2$Age.Group)
q5data.2$Age.Group[q5data$Age.Group == "30-50" | q5data$Age.Group == "Under 30"] <- "Under 50"
q5data.2$Age.Group <- factor(q5data.2$Age.Group, levels = c("Under 50", "Over 50"))

fit2 <- lm(Cholesterol ~ Gender + Age.Group + Gender:Age.Group, data = q5data.2)
summary(fit2)

################################################################

png("images/q5_fit1.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(as.numeric(q5data$Age.Group[q5data$Gender == "Female"]), q5data$Cholesterol[q5data$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(1, 3),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data$Age.Group[q5data$Gender == "Male"]), q5data$Cholesterol[q5data$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 30", "30 - 50", "Over 50"), at = c(1,2,3), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Male", 3), Cholesterol = rep(0,3))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Female", 3), Cholesterol = rep(0,3))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- predict(fit1, newdata = nd.m)
pf <- predict(fit1, newdata = nd.f)

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit1$fitted.values, fit1$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Cholesterol Level (mg)",
     ylab = "Residual",
     xlim = c(200, 610),
     ylim = c(-375, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit1$fitted.values, studres(fit1),
     main = "Studentized Residual Plot",
     xlab = "Fitted Cholesterol (mg)",
     ylab = "Students Residual",
     xlim = c(200, 610),
     ylim = c(-4, 4),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data)-length(fit1$coefficients)-2)) 
plot(fit1, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit1, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit1) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit1)),max(studres(fit1)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Cholesterol Level onto Age Group and Gender",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

################################################################

png("images/q5_fit2.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,5.5,0))

plot(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Female"]), q5data.2$Cholesterol[q5data.2$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(0.8,2.2),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Male"]), q5data.2$Cholesterol[q5data.2$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 50", "Over 50"), at = c(1,2), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Male", 2), Cholesterol = rep(0,2))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Female", 2), Cholesterol = rep(0,2))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- predict(fit2, newdata = nd.m)
pf <- predict(fit2, newdata = nd.f)

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit2$fitted.values, fit2$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted Cholesterol Level (mg)",
     ylab = "Residual",
     xlim = c(200, 500),
     ylim = c(-375, 650),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit2$fitted.values, studres(fit2),
     main = "Studentized Residual Plot",
     xlab = "Fitted Cholesterol (mg)",
     ylab = "Students Residual",
     xlim = c(200, 500),
     ylim = c(-4, 4.5),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data.2)-length(fit2$coefficients)-2)) 
plot(fit2, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit2, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit2) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.6),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit2)-1),max(studres(fit2)),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Cholesterol Level onto Age Group and Gender: \n Age Groups \"Under 30\" and \"30-50\" Collapsed",
      outer = T,
      padj = 0,
      cex = 1.2, font = 2)

dev.off()

################################################################

png("images/q5_histograms_a.png",
    height = 480, width = 600)

par(mfrow = c(1,2), oma = c(0,0,4,0))

hist(q5data$Cholesterol, 
     main = "Distribution of Cholesterol Levels",
     xlab = "Cholesterol Level (mg)",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

hist(log(q5data$Cholesterol),
     main = "Distribution of ln[Cholesterol] Levels",
     xlab = "Cholesterol Level (ln[mg])",
     ylab = "Frequency",
     cex.lab = 1.3, cex.main = 1.4, font.main = 1)

mtext(text = "Histograms of Untransformed and Log-Transformed Cholesterol Data",
      outer = T,
      padj = -.25,
      cex = 1.2, font = 2)

dev.off()

################################################################

x <- data.frame(P = c(shapiro.test(q5data$Cholesterol)$p.value, 
                      shapiro.test(log(q5data$Cholesterol))$p.value))
colnames(x) <- "P-Value"
rownames(x) <- c("Untransformed Cholesterol Data", "Log-Transformed Cholesterol Data")

pandoc.table(x,
             caption = "**Table Q51:** Shapiro-Wilk normality test results for untransformed and log-transformed cholesterol data. The p-value of less than 0.05 for the untransformed data means we should reject the assumption that the unstransformed data are normally distributed. Conversely, the p-value of more than 0.05 for the log-transformed data indicates that we can accept the assumption that the log-transformed cholesterol data are normally distributed",
             split.table = Inf)

################################################################

fit1l <- lm(log(Cholesterol) ~ Gender + Age.Group + Gender:Age.Group, data = q5data)
summary(fit1l)

################################################################

fit2l <- lm(log(Cholesterol) ~ Gender + Age.Group + Gender:Age.Group, data = q5data.2)
summary(fit2l)

################################################################

png("images/q5_fitl1.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,4,0))

plot(as.numeric(q5data$Age.Group[q5data$Gender == "Female"]), q5data$Cholesterol[q5data$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(1, 3),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data$Age.Group[q5data$Gender == "Male"]), q5data$Cholesterol[q5data$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 30", "30 - 50", "Over 50"), at = c(1,2,3), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Male", 3), Cholesterol = rep(0,3))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 30", "30-50", "Over 50"), Gender = rep("Female", 3), Cholesterol = rep(0,3))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 30", "30-50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- exp(predict(fit1l, newdata = nd.m))
pf <- exp(predict(fit1l, newdata = nd.f))

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit1l$fitted.values, fit1l$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Residual",
     xlim = c(5, 6),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit1l$fitted.values, studres(fit1l),
     main = "Studentized Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Students Residual",
     xlim = c(5, 6),
     ylim = c(-3, 3),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data)-length(fit1l$coefficients)-2)) 
plot(fit1l, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit1l, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit1l) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit1l)-1),max(studres(fit1l)+1),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Log Transformed Cholesterol Level onto Age Group and Gender",
      outer = T,
      padj = -0.25,
      cex = 1.2, font = 2)

dev.off()

################################################################

png("images/q5_fitl2.png",
    height = 620, width = 760)

par(mfrow = c(2,3), oma = c(0,0,6,0))

plot(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Female"]), q5data.2$Cholesterol[q5data.2$Gender == "Female"],
     main = "Fitted Regression Line",
     xlab = "Age Group",
     ylab = "Cholesterol Level (mg)",
     xlim = c(0.9, 2.1),
     ylim = c(25, 1275),
     pch = 20, col = "forestgreen",
     axes = F,
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
points(as.numeric(q5data.2$Age.Group[q5data.2$Gender == "Male"]), q5data.2$Cholesterol[q5data.2$Gender == "Male"],
       pch = 20, col = "red")
box()
axis(1, labels = c("Under 50", "Over 50"), at = c(1,2), cex = .9)
axis(2, at = (seq(50, 1250, 200)), cex = .9)

nd.m <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Male", 2), Cholesterol = rep(0,2))
nd.m$Age.Group <- factor(nd.m$Age.Group, levels = c("Under 50", "Over 50"))
nd.m$Gender <- factor(nd.m$Gender, levels = c("Female", "Male"))

nd.f <- data.frame(Age.Group = c("Under 50", "Over 50"), Gender = rep("Female", 2), Cholesterol = rep(0,2))
nd.f$Age.Group <- factor(nd.f$Age.Group, levels = c("Under 50", "Over 50"))
nd.f$Gender <- factor(nd.f$Gender, levels = c("Female", "Male"))

pm <- exp(predict(fit2l, newdata = nd.m))
pf <- exp(predict(fit2l, newdata = nd.f))

lines(as.numeric(nd.m$Age.Group), pm, col = "red")
lines(as.numeric(nd.f$Age.Group), pf, col = "forestgreen")

legend("topright",
       legend = c("Female", "Male"),
       pch = 20,
       col = c("forestgreen", "red"))

#-------------------------------------------#

plot(fit2l$fitted.values, fit2l$residuals,
     main = "Raw Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Residual",
     xlim = c(5, 6),
     ylim = c(-2, 2),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

plot(fit2l$fitted.values, studres(fit2l),
     main = "Studentized Residual Plot",
     xlab = "Fitted ln[Cholesterol] Level (ln[mg])",
     ylab = "Students Residual",
     xlim = c(5, 6),
     ylim = c(-3, 3),
     cex.lab = 1.4, cex.main = 1.5, font.main = 1)
abline(h = 0)

#-------------------------------------------#

cutoff <- 4/((nrow(q5data.2)-length(fit2l$coefficients)-2)) 
plot(fit2l, which=4, cook.levels=cutoff,
     cex.lab = 1.4, sub = NA)

par(cex.lab = 1.4, cex.main = 1.5, font.main = 1)

#-------------------------------------------#

qqPlot(fit2l, simulate = F,
       main = "Q-Q Plot",
       xlab = "Quantiles",
       ylab = "Studentized Residuals",
       grid = F, lwd = 1.5, cex = 1)

#-------------------------------------------#

hist(studres(fit2l) , freq=FALSE, 
   main="Distribution of Studentized Residuals",
   xlab = "Studentized Residual",
   ylim = c(0,0.5),
   cex.lab = 1.4, cex.main = 1.5, font.main = 1)

xfit<-seq(min(studres(fit2l)-1),max(studres(fit2l)+1),length=40) 
yfit<-dnorm(xfit) 
lines(xfit, yfit, col = "red")



mtext(text = "Fitted Regression Line and Diagnostic Plots \n Regression of Log Transformed Cholesterol Level onto Age Group and Gender: \n Age Groups \"Under 30\" and \"30-50\" Collapsed",
      outer = T,
      padj = 0,
      cex = 1.2, font = 2)

dev.off()

################################################################

summary(fit1l)

summary(fit2l)

```

<br>
<br>

## A6


<br>
<br>

## A7